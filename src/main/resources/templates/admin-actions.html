<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>管理メニュー</title>
  <style>
    body { font-family: system-ui, -apple-system, 'Segoe UI', 'Hiragino Sans', 'Yu Gothic', sans-serif; margin:0; background:#f5f7fb; color:#0f172a; }
    .container { max-width: 960px; margin: 0 auto; padding: 24px; }
    .card { background:#fff; border:1px solid #e2e8f0; border-radius:12px; padding:16px; margin-bottom:16px; }
    .row { display:flex; gap:12px; align-items:end; flex-wrap:wrap; }
    input, button { padding:8px 10px; border-radius:8px; border:1px solid #cbd5e1; }
    button { background:#2563eb; color:#fff; border:none; cursor:pointer; }
    .muted { color:#64748b; font-size:12px; }
    ul { line-height:1.9; }
    a { color:#2563eb; text-decoration:none; }
  </style>
</head>
<body>
  <div class="container">
    <h2>管理メニュー</h2>
    <div class="card">
      <p>次のページから設定できます。</p>
      <ul>
        <li><a href="/employee-master">従業員マスタ（登録・スキル付与・個別ルール）</a></li>
        <li><a href="/skill-management">スキル管理（登録・優先度設定 1〜10）</a></li>
        <li><a href="/skill-patterns">スキル別勤務パターン（6h/4hのゲート設定）</a></li>
        <li><a href="/rules">勤務ルール設定（デフォルトルール）</a></li>
        <li><a href="/demand">需要管理</a></li>
        <li><a href="/timeline">タイムライン</a></li>
        <li><a href="/dashboard">ダッシュボード</a></li>
      </ul>
    </div>

    <div class="card">
      <h3 style="margin:0 0 8px;">時間帯ごとの簡易需要作成</h3>
      <div class="row">
        <label>日付 <input type="date" id="h_date" /></label>
        <label>開始時 <input type="number" id="h_start" value="9" min="0" max="23" /></label>
        <label>終了時 <input type="number" id="h_end" value="18" min="1" max="24" /></label>
        <label>SkillId(任意) <input type="number" id="h_skill" /></label>
        <button onclick="genHourly()">作成</button>
        <a href="/timeline">タイムライン</a>
      </div>
      <div id="msg2" class="muted"></div>
    </div>
  </div>
  <script>
    async function api(url, opt={}){
      const res = await fetch(url, { credentials:'include', headers:{'Content-Type':'application/json'}, ...opt });
      const ct = res.headers.get('content-type')||''; const data = ct.includes('json') ? await res.json() : await res.text();
      if(!res.ok) throw new Error((data&&data.message) || ('HTTP '+res.status));
      if(data && data.success===false) throw new Error(data.message||'処理に失敗しました');
      return data;
    }
    async function genHourly(){
      const date = document.getElementById('h_date').value;
      const s = Number(document.getElementById('h_start').value||'9');
      const e = Number(document.getElementById('h_end').value||'18');
      const skillId = document.getElementById('h_skill').value ? Number(document.getElementById('h_skill').value) : null;
      if(!date){ document.getElementById('msg2').textContent='日付は必須です'; return; }
      try {
        // 1時間ごとに1席の需要を作る簡易API（需要画面の機能と同等の補助）
        let created = 0;
        for(let h=s; h<e; h++){
          const body = { date, startTime: `${String(h).padStart(2,'0')}:00`, endTime:`${String(h+1).padStart(2,'0')}:00`, requiredSeats: 1, skillId };
          await api('/api/demand/intervals', { method:'POST', body: JSON.stringify(body) });
          created++;
        }
        document.getElementById('msg2').textContent = `${created}件の需要を作成しました`;
      } catch(e){ document.getElementById('msg2').textContent = e.message||'作成に失敗しました'; }
    }
  </script>
</body>
</html>
